<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GeoJSON Editor Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      padding: 2rem;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: #161b22;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      border: 1px solid #30363d;
    }

    h1 {
      color: #e6edf3;
      margin-bottom: 1rem;
      font-size: 2rem;
    }

    .description {
      color: #8b949e;
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    .description strong {
      color: #c9d1d9;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: #21262d;
      border-radius: 8px;
      border: 1px solid #30363d;
    }

    .controls-section {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .controls-section h4 {
      margin: 0;
      color: #e6edf3;
      font-size: 1rem;
      border-bottom: 2px solid #58a6ff;
      padding-bottom: 0.5rem;
    }

    .controls-section > p {
      color: #8b949e;
    }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .control-group label {
      font-weight: 600;
      color: #c9d1d9;
      font-size: 0.9rem;
    }

    .control-group select,
    .control-group input[type="text"],
    .control-group textarea {
      padding: 0.5rem;
      border: 1px solid #30363d;
      border-radius: 4px;
      font-size: 0.9rem;
      font-family: 'Courier New', monospace;
      background: #0d1117;
      color: #c9d1d9;
    }

    .control-group select:focus,
    .control-group input[type="text"]:focus,
    .control-group textarea:focus {
      outline: none;
      border-color: #58a6ff;
    }

    .control-group textarea {
      resize: vertical;
      min-height: 60px;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .checkbox-group label {
      margin: 0;
      color: #c9d1d9;
    }

    .checkbox-group small {
      color: #8b949e !important;
    }

    .editor-container {
      margin-top: 2rem;
      border: 2px solid #58a6ff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(88, 166, 255, 0.15), 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .editor-label {
      background: linear-gradient(90deg, #58a6ff, #a371f7);
      color: white;
      padding: 0.5rem 1rem;
      font-weight: 600;
      font-size: 0.9rem;
      letter-spacing: 0.5px;
    }

    .output {
      margin-top: 2rem;
      padding: 1rem;
      background: #21262d;
      border-radius: 8px;
      border: 1px solid #30363d;
    }

    .output h3 {
      color: #e6edf3;
      margin-bottom: 0.5rem;
    }

    .output p {
      color: #8b949e;
    }

    .output pre {
      background: #0d1117;
      color: #c9d1d9;
      padding: 1rem;
      border-radius: 4px;
      max-height: 400px;
      overflow-x: auto;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      border: 1px solid #30363d;
    }

    button {
      padding: 0.5rem 1rem;
      background: #238636;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s;
    }

    button:hover {
      background: #2ea043;
    }


    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .header h1 {
      margin: 0;
      flex: 1;
    }

    .github-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: #21262d;
      color: #c9d1d9;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.9rem;
      transition: background 0.2s;
      border: 1px solid #30363d;
    }

    .github-link:hover {
      background: #30363d;
    }

    .github-link svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    .code-example {
      margin-top: 2rem;
      padding: 1rem;
      background: #21262d;
      border-radius: 8px;
      border: 1px solid #30363d;
    }

    .code-example h3 {
      color: #e6edf3;
      margin-bottom: 0.5rem;
    }

    .code-example p {
      color: #8b949e;
    }

    .code-example pre {
      background: #0d1117;
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      line-height: 1.5;
      margin: 0;
      color: #c9d1d9;
      border: 1px solid #30363d;
    }

    /* Prism.js syntax highlighting */
    .code-example .token.comment,
    .code-example .token.prolog,
    .code-example .token.doctype { color: #8b949e; }

    .code-example .token.punctuation { color: #c9d1d9; }

    .code-example .token.property,
    .code-example .token.tag,
    .code-example .token.boolean,
    .code-example .token.number,
    .code-example .token.constant,
    .code-example .token.symbol { color: #79c0ff; }

    .code-example .token.selector,
    .code-example .token.attr-name,
    .code-example .token.string,
    .code-example .token.char,
    .code-example .token.builtin { color: #a5d6ff; }

    .code-example .token.operator,
    .code-example .token.entity,
    .code-example .token.url,
    .code-example .token.variable { color: #c9d1d9; }

    .code-example .token.atrule,
    .code-example .token.attr-value,
    .code-example .token.keyword { color: #ff7b72; }

    .code-example .token.function { color: #d2a8ff; }

    .code-example .token.regex,
    .code-example .token.important { color: #ffa657; }

    /* Modal styles */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .modal-backdrop {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
    }

    .modal-content {
      position: relative;
      background: #161b22;
      border-radius: 12px;
      width: 90%;
      max-width: 700px;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      border: 1px solid #30363d;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid #30363d;
      background: #21262d;
    }

    .modal-header h3 {
      margin: 0;
      color: #e6edf3;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #8b949e;
      padding: 0;
      line-height: 1;
    }

    .modal-close:hover {
      color: #e6edf3;
    }

    .modal-body {
      padding: 1.5rem;
      overflow-y: auto;
      max-height: calc(90vh - 60px);
    }

    .modal-body p {
      color: #8b949e;
    }

    .modal .theme-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .modal .theme-actions button {
      padding: 0.5rem 1rem;
    }

    #themeTextarea {
      width: 100%;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      padding: 1rem;
      border: 1px solid #30363d;
      border-radius: 4px;
      resize: vertical;
      background: #0d1117;
      color: #c9d1d9;
    }

    #themeTextarea:focus {
      outline: none;
      border-color: #58a6ff;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>GeoJSON Editor Component Demo</h1>
      <a href="https://github.com/softwarity/geojson-editor" target="_blank" rel="noopener noreferrer" class="github-link">
        <svg viewBox="0 0 16 16" aria-hidden="true">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
        View on GitHub
      </a>
    </div>
    <div class="description">
      This demo showcases the &lt;geojson-editor&gt; Web Component with syntax highlighting,
      collapsible nodes, and automatic color picker detection.
      <br><br>
      <strong>Color Detection:</strong> The editor automatically detects hex colors (#RRGGBB) in any JSON string value
      and displays a color indicator in the gutter. Click it to open a color picker!
    </div>

    <div class="controls">
      <div class="controls-section">
        <h4>Theme</h4>
        <div class="controls-grid">
          <div class="control-group">
            <label for="colorSchemeSelect">Color Scheme</label>
            <select id="colorSchemeSelect">
              <option value="dark" selected>Dark</option>
              <option value="light">Light</option>
            </select>
          </div>
          <div class="control-group">
            <label for="themePresetMainSelect">Theme Preset</label>
            <div style="display: flex; gap: 0.5rem;">
              <select id="themePresetMainSelect" style="flex: 1;">
                <option value="vscode" selected>VSCode (Default)</option>
                <option value="github">GitHub</option>
                <option value="onedark">One Dark / One Light</option>
                <option value="solarized">Solarized</option>
              </select>
              <button onclick="openThemeModal()" title="Edit theme" style="padding: 0.5rem 0.75rem;">‚úèÔ∏è</button>
            </div>
          </div>
        </div>
      </div>

      <div class="controls-section">
        <h4>Dark Mode Detection</h4>
        <p style="color: #666; font-size: 0.85rem; margin-bottom: 1rem;">
          The <code>dark-selector</code> attribute lets you specify a CSS selector. The component watches for this selector
          to match, and when it does, applies its dark theme. You can use any valid CSS selector.
        </p>
        <div class="controls-grid">
          <div class="control-group">
            <label for="darkSelectorExampleSelect">Examples</label>
            <select id="darkSelectorExampleSelect">
              <option value=".dark">Self</option>
              <option value="html.dark">Tailwind CSS</option>
              <option value="html[data-bs-theme=dark]">Bootstrap</option>
            </select>
          </div>
          <div class="control-group">
            <label for="selectorPreview">Attribute Value</label>
            <input type="text" id="selectorPreview" value="dark-selector='.dark'" readonly style="font-size: 0.8rem; background: #0d1117; border-color: #30363d;">
          </div>
        </div>
        <div id="selectorDescription" style="background: #0d1117; padding: 0.75rem; border-radius: 4px; margin-top: 1rem; font-size: 0.85rem; color: #8b949e; border-left: 3px solid #58a6ff;">
          <strong>Example:</strong> <code>.dark</code> ‚Äî The component watches for a <code>dark</code> class on itself. When present, dark theme is applied.
        </div>
      </div>

      <div class="controls-section">
        <h4>Editor Options</h4>
        <div class="control-group" style="margin-bottom: 1rem;">
          <label for="placeholderInput">Placeholder Text</label>
          <input type="text" id="placeholderInput" value="Enter GeoJSON features here...">
          <small style="color: #666; font-size: 0.85rem;">Shown when editor is empty</small>
        </div>
        <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
          <div class="checkbox-group">
            <input type="checkbox" id="featureCollectionCheck" checked>
            <label for="featureCollectionCheck">FeatureCollection mode</label>
            <small style="color: #888; font-size: 0.8rem; margin-left: 0.5rem;">‚Äî wrap features in FeatureCollection</small>
          </div>
          <div class="checkbox-group">
            <input type="checkbox" id="autoFormatCheck" checked>
            <label for="autoFormatCheck">Auto-format JSON</label>
            <small style="color: #888; font-size: 0.8rem; margin-left: 0.5rem;">‚Äî indent in real-time</small>
          </div>
          <div class="checkbox-group">
            <input type="checkbox" id="readonlyCheck">
            <label for="readonlyCheck">Readonly mode</label>
            <small style="color: #888; font-size: 0.8rem; margin-left: 0.5rem;">‚Äî disable editing</small>
          </div>
        </div>
      </div>
    </div>

    <div class="editor-container">
      <div class="editor-label">‚ñ∂ GeoJSON Editor Component</div>
      <geojson-editor id="editor"></geojson-editor>
    </div>

    <div class="output">
      <h3>Change Events:</h3>
      <p style="color: #666; font-size: 0.85rem; margin-bottom: 0.5rem;">
        The component emits <code>change</code> events with <code>e.detail</code> containing the parsed GeoJSON object directly.
      </p>
      <pre id="eventLog">Waiting for change events...</pre>
    </div>

    <div class="output" style="background: #21262d; border-color: #f8514966;">
      <h3 style="color: #f85149;">Error Events:</h3>
      <p style="color: #666; font-size: 0.85rem; margin-bottom: 0.5rem;">
        When JSON is invalid, the component emits <code>error</code> events with:
        <strong>timestamp</strong>,
        <strong>error</strong> (error message),
        <strong>content</strong> (editor content for debugging)
      </p>
      <pre id="errorLog">No errors</pre>
    </div>

    <div class="code-example">
      <h3>HTML Code:</h3>
      <p style="color: #666; font-size: 0.85rem; margin-bottom: 0.5rem;">
        Copy this code to use the component in your own page (updates automatically with your settings)
      </p>
      <pre id="htmlCode"></pre>
    </div>

  </div>

  <!-- Theme Editor Modal -->
  <div id="themeModal" class="modal" style="display: none;">
    <div class="modal-backdrop" onclick="closeThemeModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3>‚úèÔ∏è Theme Editor</h3>
        <button class="modal-close" onclick="closeThemeModal()">√ó</button>
      </div>
      <div class="modal-body">
        <p style="color: #666; font-size: 0.85rem; margin-bottom: 1rem;">
          Customize the current theme. Edit the JSON below and click "Apply" to preview.<br>
          Use "Copy Code" to get the JavaScript snippet for your implementation.
        </p>
        <textarea id="themeTextarea" rows="20" spellcheck="false"></textarea>
        <div class="theme-actions">
          <button onclick="applyTheme()">‚úì Apply</button>
          <button onclick="resetTheme()">‚Ü∫ Reset to Default</button>
          <button onclick="copyTheme()">üìã Copy Code</button>
        </div>
      </div>
    </div>
  </div>

  
  <script>
    const editor = document.getElementById('editor');
    const eventLog = document.getElementById('eventLog');
    const errorLog = document.getElementById('errorLog');
    const placeholderInput = document.getElementById('placeholderInput');
    const darkSelectorExampleSelect = document.getElementById('darkSelectorExampleSelect');
    const colorSchemeSelect = document.getElementById('colorSchemeSelect');
    const selectorPreview = document.getElementById('selectorPreview');
    const selectorDescription = document.getElementById('selectorDescription');
    const readonlyCheck = document.getElementById('readonlyCheck');
    const autoFormatCheck = document.getElementById('autoFormatCheck');
    const featureCollectionCheck = document.getElementById('featureCollectionCheck');
    const themeModal = document.getElementById('themeModal');
    const themeTextarea = document.getElementById('themeTextarea');
    const themePresetMainSelect = document.getElementById('themePresetMainSelect');

    // Pre-defined theme presets
    const themePresets = {
      vscode: {
        dark: {
          background: '#1e1e1e', textColor: '#d4d4d4', caretColor: '#fff',
          gutterBackground: '#252526', gutterBorder: '#3e3e42',
          jsonKey: '#9cdcfe', jsonString: '#ce9178', jsonNumber: '#b5cea8',
          jsonBoolean: '#569cd6', jsonNull: '#569cd6', jsonPunctuation: '#d4d4d4',
          collapseButton: '#c586c0', collapseButtonBg: '#3e3e42', collapseButtonBorder: '#555',
          geojsonKey: '#c586c0', geojsonType: '#4ec9b0', geojsonTypeInvalid: '#f44747', jsonKeyInvalid: '#f44747'
        },
        light: {
          background: '#ffffff', textColor: '#333333', caretColor: '#000',
          gutterBackground: '#f5f5f5', gutterBorder: '#ddd',
          jsonKey: '#0000ff', jsonString: '#a31515', jsonNumber: '#098658',
          jsonBoolean: '#0000ff', jsonNull: '#0000ff', jsonPunctuation: '#333333',
          collapseButton: '#a31515', collapseButtonBg: '#e0e0e0', collapseButtonBorder: '#999',
          geojsonKey: '#af00db', geojsonType: '#267f99', geojsonTypeInvalid: '#d32f2f', jsonKeyInvalid: '#d32f2f'
        }
      },
      github: {
        dark: {
          background: '#0d1117', textColor: '#c9d1d9', caretColor: '#c9d1d9',
          gutterBackground: '#161b22', gutterBorder: '#30363d',
          jsonKey: '#79c0ff', jsonString: '#a5d6ff', jsonNumber: '#79c0ff',
          jsonBoolean: '#ff7b72', jsonNull: '#ff7b72', jsonPunctuation: '#c9d1d9',
          collapseButton: '#d2a8ff', collapseButtonBg: '#30363d', collapseButtonBorder: '#484f58',
          geojsonKey: '#d2a8ff', geojsonType: '#7ee787', geojsonTypeInvalid: '#f85149', jsonKeyInvalid: '#f85149'
        },
        light: {
          background: '#ffffff', textColor: '#24292f', caretColor: '#24292f',
          gutterBackground: '#f6f8fa', gutterBorder: '#d0d7de',
          jsonKey: '#0550ae', jsonString: '#0a3069', jsonNumber: '#0550ae',
          jsonBoolean: '#cf222e', jsonNull: '#cf222e', jsonPunctuation: '#24292f',
          collapseButton: '#8250df', collapseButtonBg: '#eaeef2', collapseButtonBorder: '#afb8c1',
          geojsonKey: '#8250df', geojsonType: '#116329', geojsonTypeInvalid: '#cf222e', jsonKeyInvalid: '#cf222e'
        }
      },
      onedark: {
        dark: {
          background: '#282c34', textColor: '#abb2bf', caretColor: '#528bff',
          gutterBackground: '#21252b', gutterBorder: '#3e4451',
          jsonKey: '#e06c75', jsonString: '#98c379', jsonNumber: '#d19a66',
          jsonBoolean: '#d19a66', jsonNull: '#d19a66', jsonPunctuation: '#abb2bf',
          collapseButton: '#c678dd', collapseButtonBg: '#3e4451', collapseButtonBorder: '#4b5263',
          geojsonKey: '#c678dd', geojsonType: '#56b6c2', geojsonTypeInvalid: '#e06c75', jsonKeyInvalid: '#e06c75'
        },
        light: {
          background: '#fafafa', textColor: '#383a42', caretColor: '#526fff',
          gutterBackground: '#f0f0f0', gutterBorder: '#e0e0e0',
          jsonKey: '#e45649', jsonString: '#50a14f', jsonNumber: '#986801',
          jsonBoolean: '#986801', jsonNull: '#986801', jsonPunctuation: '#383a42',
          collapseButton: '#a626a4', collapseButtonBg: '#e0e0e0', collapseButtonBorder: '#999',
          geojsonKey: '#a626a4', geojsonType: '#0184bc', geojsonTypeInvalid: '#e45649', jsonKeyInvalid: '#e45649'
        }
      },
      solarized: {
        dark: {
          background: '#002b36', textColor: '#839496', caretColor: '#839496',
          gutterBackground: '#073642', gutterBorder: '#094652',
          jsonKey: '#268bd2', jsonString: '#2aa198', jsonNumber: '#d33682',
          jsonBoolean: '#cb4b16', jsonNull: '#cb4b16', jsonPunctuation: '#839496',
          collapseButton: '#6c71c4', collapseButtonBg: '#073642', collapseButtonBorder: '#586e75',
          geojsonKey: '#6c71c4', geojsonType: '#859900', geojsonTypeInvalid: '#dc322f', jsonKeyInvalid: '#dc322f'
        },
        light: {
          background: '#fdf6e3', textColor: '#657b83', caretColor: '#657b83',
          gutterBackground: '#eee8d5', gutterBorder: '#e0dbc8',
          jsonKey: '#268bd2', jsonString: '#2aa198', jsonNumber: '#d33682',
          jsonBoolean: '#cb4b16', jsonNull: '#cb4b16', jsonPunctuation: '#657b83',
          collapseButton: '#6c71c4', collapseButtonBg: '#eee8d5', collapseButtonBorder: '#93a1a1',
          geojsonKey: '#6c71c4', geojsonType: '#859900', geojsonTypeInvalid: '#dc322f', jsonKeyInvalid: '#dc322f'
        }
      }
    };
    const htmlCode = document.getElementById('htmlCode');

    // Internal dark selector value
    let darkSelector = '.dark';

    // Selector descriptions explaining what each selector does
    const selectorDescriptions = {
      '.dark': '<strong>Example:</strong> <code>.dark</code> ‚Äî The component watches for a <code>dark</code> class on itself. When present, dark theme is applied.',
      'html.dark': '<strong>Example:</strong> <code>html.dark</code> ‚Äî The component watches for a <code>dark</code> class on the <code>&lt;html&gt;</code> element. Useful when your page uses a global dark mode class.',
      'html[data-bs-theme=dark]': '<strong>Example:</strong> <code>html[data-bs-theme=dark]</code> ‚Äî The component watches for a <code>data-bs-theme="dark"</code> attribute on the <code>&lt;html&gt;</code> element.'
    };

    // Handle dark selector example selection
    darkSelectorExampleSelect.addEventListener('change', (e) => {
      darkSelector = e.target.value;
      selectorPreview.value = `dark-selector="${darkSelector}"`;
      selectorDescription.innerHTML = selectorDescriptions[darkSelector];
      updateEditor();
      applyColorScheme();
    });

    // Parse dark selector to determine target element
    function parseSelector(selector) {
      // Check for class on component itself (.dark)
      if (selector.startsWith('.') && !selector.includes(' ')) {
        return {
          target: 'component',
          type: 'class',
          value: selector.substring(1) // Remove the dot
        };
      }

      // Check for class on html (html.dark)
      const htmlClassMatch = selector.match(/^html\.(.+)$/);
      if (htmlClassMatch) {
        return {
          target: 'html',
          type: 'class',
          value: htmlClassMatch[1]
        };
      }

      // Check for attribute on html (html[data-bs-theme=dark])
      const htmlAttrMatch = selector.match(/^html\[([^=]+)=([^\]]+)\]$/);
      if (htmlAttrMatch) {
        return {
          target: 'html',
          type: 'attribute',
          attr: htmlAttrMatch[1],
          value: htmlAttrMatch[2]
        };
      }

      return null;
    }

    // Apply color scheme by modifying the appropriate target
    function applyColorScheme() {
      const scheme = colorSchemeSelect.value;
      const isDark = scheme === 'dark';

      const target = parseSelector(darkSelector);
      if (!target) return;

      // Apply to component
      if (target.target === 'component') {
        if (isDark) {
          editor.classList.add(target.value);
        } else {
          editor.classList.remove(target.value);
        }
      }

      // Apply to html element
      if (target.target === 'html') {
        if (target.type === 'class') {
          if (isDark) {
            document.documentElement.classList.add(target.value);
          } else {
            document.documentElement.classList.remove(target.value);
          }
        } else if (target.type === 'attribute') {
          // For Bootstrap: set attribute to "dark" or "light"
          document.documentElement.setAttribute(target.attr, scheme);
        }
      }

    }

    // Update editor attributes from inputs
    function updateEditor() {
      editor.setAttribute('placeholder', placeholderInput.value);
      editor.setAttribute('dark-selector', darkSelector);

      if (featureCollectionCheck.checked) {
        editor.setAttribute('feature-collection', '');
      } else {
        editor.removeAttribute('feature-collection');
      }

      if (autoFormatCheck.checked) {
        editor.setAttribute('auto-format', '');
      } else {
        editor.removeAttribute('auto-format');
      }

      if (readonlyCheck.checked) {
        editor.setAttribute('readonly', '');
      } else {
        editor.removeAttribute('readonly');
      }

      updateHTMLCode();
    }

    // Update HTML code display
    function updateHTMLCode() {
      const placeholder = placeholderInput.value;
      const readonly = readonlyCheck.checked;
      const autoFormat = autoFormatCheck.checked;
      const featureCollection = featureCollectionCheck.checked;
      const scheme = colorSchemeSelect.value;
      const isDark = scheme === 'dark';

      // Parse selector to understand its type
      const selectorTarget = parseSelector(darkSelector);

      // Build component attributes
      let attrs = [];
      if (featureCollection) attrs.push('feature-collection');
      if (placeholder) attrs.push(`placeholder="${placeholder.replace(/"/g, '&quot;')}"`);
      if (autoFormat) attrs.push('auto-format');
      if (readonly) attrs.push('readonly');
      if (darkSelector) attrs.push(`dark-selector="${darkSelector.replace(/"/g, '&quot;')}"`);

      // Build HTML tag attributes based on selector type
      let htmlAttrs = 'lang="en"';
      let componentClass = '';

      if (selectorTarget) {
        if (selectorTarget.target === 'html') {
          if (selectorTarget.type === 'class' && isDark) {
            htmlAttrs += ` class="${selectorTarget.value}"`;
          } else if (selectorTarget.type === 'attribute') {
            htmlAttrs += ` ${selectorTarget.attr}="${scheme}"`;
          }
        } else if (selectorTarget.target === 'component' && isDark) {
          componentClass = ` class="${selectorTarget.value}"`;
        }
      }

      let code = '<!DOCTYPE html>\n';
      code += `<html ${htmlAttrs}>\n`;
      code += '<head>\n';
      code += '  <meta charset="UTF-8">\n';
      code += '  <title>GeoJSON Editor</title>\n';
      code += '  <script type="module">\n';
      code += '    const editor = document.querySelector(\'geojson-editor\');\n\n';
      code += '    // Valid GeoJSON - emits parsed object directly\n';
      code += '    editor.addEventListener(\'change\', (e) => {\n';
      code += '      console.log(\'GeoJSON:\', e.detail);\n';
      code += '    });\n\n';
      code += '    // Invalid JSON or GeoJSON validation error\n';
      code += '    editor.addEventListener(\'error\', (e) => {\n';
      code += '      console.error(\'Error:\', e.detail.error);\n';
      code += '    });\n';
      code += '  <\/script>\n';
      code += '</head>\n';
      code += '<body>\n';
      code += `  <geojson-editor${componentClass}\n`;
      code += '    ' + attrs.join('\n    ') + '\n';
      code += '  ></geojson-editor>\n\n';
      code += '  <script type="module" src="https://unpkg.com/@softwarity/geojson-editor"><\/script>\n';
      code += '</body>\n';
      code += '</html>';

      // Apply HTML syntax highlighting with Prism.js
      htmlCode.innerHTML = Prism.highlight(code, Prism.languages.markup, 'markup');
    }

    // Listen to editor change events (valid JSON parsed object)
    editor.addEventListener('change', (e) => {
      eventLog.textContent = JSON.stringify(e.detail, null, 2);
      // Clear error log on successful parse
      errorLog.textContent = 'No errors';
      errorLog.style.color = '';
    });

    // Listen to editor error events (invalid JSON)
    editor.addEventListener('error', (e) => {
      errorLog.textContent = JSON.stringify(e.detail, null, 2);
      errorLog.style.color = '#f85149';
    });

    // Listen to input changes
    placeholderInput.addEventListener('input', updateEditor);

    // Handle feature-collection mode toggle: reload sample data in appropriate format
    featureCollectionCheck.addEventListener('change', () => {
      updateEditor();
      loadSampleData();
    });
    readonlyCheck.addEventListener('change', updateEditor);
    autoFormatCheck.addEventListener('change', updateEditor);

    // Color scheme change - applies to the selector target and updates HTML code
    colorSchemeSelect.addEventListener('change', () => {
      applyColorScheme();
      updateHTMLCode(); // Update the generated HTML code to reflect the new scheme
    });

    // Apply preset theme directly from main selector
    themePresetMainSelect.addEventListener('change', () => {
      const presetName = themePresetMainSelect.value;
      if (presetName && themePresets[presetName]) {
        editor.setTheme(themePresets[presetName]);
      }
    });

    // Open theme modal
    function openThemeModal() {
      loadCurrentTheme();
      themeModal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    // Close theme modal
    function closeThemeModal() {
      themeModal.style.display = 'none';
      document.body.style.overflow = '';
    }

    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && themeModal.style.display === 'flex') {
        closeThemeModal();
      }
    });

    // Load current theme into textarea
    function loadCurrentTheme() {
      const theme = editor.getTheme();
      themeTextarea.value = JSON.stringify(theme, null, 2);
    }

    // Apply theme from textarea
    function applyTheme() {
      try {
        const theme = JSON.parse(themeTextarea.value);
        editor.setTheme(theme);
        showThemeMessage('‚úì Theme applied!', 'success');
      } catch (e) {
        showThemeMessage('‚úó Invalid JSON: ' + e.message, 'error');
      }
    }

    // Reset to default theme (VSCode)
    function resetTheme() {
      themePresetMainSelect.value = 'vscode';
      editor.setTheme(themePresets.vscode);
      loadCurrentTheme();
      showThemeMessage('‚Ü∫ Theme reset to VSCode default', 'success');
    }

    // Copy theme to clipboard
    function copyTheme() {
      const themeCode = `// Apply custom theme to GeoJSON Editor
const editor = document.querySelector('geojson-editor');
editor.setTheme(${themeTextarea.value});`;

      navigator.clipboard.writeText(themeCode).then(() => {
        showThemeMessage('üìã Theme code copied to clipboard!', 'success');
      }).catch(() => {
        showThemeMessage('‚úó Failed to copy', 'error');
      });
    }

    // Show feedback message in theme modal
    function showThemeMessage(message, type) {
      const modalBody = themeModal.querySelector('.modal-body');
      const existing = modalBody.querySelector('.theme-message');
      if (existing) existing.remove();

      const msg = document.createElement('div');
      msg.className = 'theme-message';
      msg.style.cssText = `
        padding: 0.5rem 1rem;
        margin-top: 0.5rem;
        border-radius: 4px;
        font-size: 0.85rem;
        background: ${type === 'success' ? '#d4edda' : '#f8d7da'};
        color: ${type === 'success' ? '#155724' : '#721c24'};
      `;
      msg.textContent = message;
      modalBody.querySelector('.theme-actions').appendChild(msg);

      setTimeout(() => msg.remove(), 3000);
    }

    // Sample features array
    const sampleFeaturesArray = [
      {
        type: "Feature",
        geometry: { type: "Point", coordinates: [166.4581, -22.2758] },
        properties: { name: "Noumea Airport", type: "airport", color: "#3498db", category: "airport" }
      },
      {
        type: "Feature",
        geometry: { type: "LineString", coordinates: [[166.4, -22.2], [167.0, -22.5], [167.5, -23.0]] },
        properties: { name: "Flight Path", color: "#e74c3c", width: 2 }
      },
      {
        type: "Feature",
        geometry: {
          type: "Polygon",
          coordinates: [[[166.0, -22.0], [167.0, -22.0], [167.0, -23.0], [166.0, -23.0], [166.0, -22.0]]]
        },
        properties: { name: "Coverage Area", fill: "#2ecc71", stroke: "#27ae60", opacity: 0.5 }
      }
    ];

    // Load sample data in appropriate format based on mode
    function loadSampleData() {
      if (featureCollectionCheck.checked) {
        // Feature-collection mode: just the features (comma-separated)
        const featuresStr = sampleFeaturesArray.map(f => JSON.stringify(f, null, 2)).join(',\n');
        editor.setAttribute('value', featuresStr);
      } else {
        // Standalone mode: full FeatureCollection
        const featureCollection = { type: "FeatureCollection", features: sampleFeaturesArray };
        editor.setAttribute('value', JSON.stringify(featureCollection, null, 2));
      }
    }

    function clearEditor() {
      editor.setAttribute('value', '');
    }

    // Load initial sample automatically after component is ready
    customElements.whenDefined('geojson-editor').then(() => {
      updateEditor();
      applyColorScheme();
      loadSampleData();
    });
  </script>
  <script type="module" src="../src/geojson-editor.js"></script>
</body>
</html>
