<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>@softwarity/geojson-editor - Demo</title>
  <style>
    :root {
      --bg-canvas: #0d1117;
      --bg-primary: #161b22;
      --bg-secondary: #21262d;
      --border-default: #30363d;
      --text-primary: #e6edf3;
      --text-secondary: #c9d1d9;
      --text-muted: #8b949e;
      --accent-blue: #58a6ff;
      --accent-green: #238636;
      --accent-green-hover: #2ea043;
      --accent-purple: #a371f7;
      --accent-red: #f85149;
      --font-mono: 'Courier New', monospace;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* Palette icon using CSS mask */
    .icon-palette {
      display: inline-block;
      width: 18px;
      height: 18px;
      background-color: currentColor;
      mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 -960 960 960'%3E%3Cpath d='M480-80q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 32.5-156t88-127Q256-817 330-848.5T488-880q80 0 151 27.5t124.5 76q53.5 48.5 85 115T880-518q0 115-70 176.5T640-280h-74q-9 0-12.5 5t-3.5 11q0 12 15 34.5t15 51.5q0 50-27.5 74T480-80Zm0-400Zm-220 40q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120-160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm200 0q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120 160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17ZM480-160q9 0 14.5-5t5.5-13q0-14-15-33t-15-57q0-42 29-67t71-25h70q66 0 113-38.5T800-518q0-121-92.5-201.5T488-800q-136 0-232 93t-96 227q0 133 93.5 226.5T480-160Z'/%3E%3C/svg%3E");
      mask-size: contain;
      mask-repeat: no-repeat;
      -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 -960 960 960'%3E%3Cpath d='M480-80q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 32.5-156t88-127Q256-817 330-848.5T488-880q80 0 151 27.5t124.5 76q53.5 48.5 85 115T880-518q0 115-70 176.5T640-280h-74q-9 0-12.5 5t-3.5 11q0 12 15 34.5t15 51.5q0 50-27.5 74T480-80Zm0-400Zm-220 40q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120-160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm200 0q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120 160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17ZM480-160q9 0 14.5-5t5.5-13q0-14-15-33t-15-57q0-42 29-67t71-25h70q66 0 113-38.5T800-518q0-121-92.5-201.5T488-800q-136 0-232 93t-96 227q0 133 93.5 226.5T480-160Z'/%3E%3C/svg%3E");
      -webkit-mask-size: contain;
      -webkit-mask-repeat: no-repeat;
    }
    .icon-palette.large { width: 20px; height: 20px; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      padding: 2rem;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: var(--bg-primary);
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      border: 1px solid var(--border-default);
    }

    h1 { color: var(--text-primary); margin-bottom: 1rem; font-size: 2rem; }

    /* Shared section styles */
    .section-box {
      margin-top: 2rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: 8px;
      border: 1px solid var(--border-default);
    }
    .section-box h3 { color: var(--text-primary); margin-bottom: 0.5rem; }
    .section-box p { color: var(--text-muted); }
    .section-box pre {
      background: var(--bg-canvas);
      color: var(--text-secondary);
      padding: 1rem;
      border-radius: 4px;
      overflow: auto;
      font-family: var(--font-mono);
      font-size: 0.85rem;
      border: 1px solid var(--border-default);
    }

    .text-muted { color: var(--text-muted); font-size: 0.85rem; }
    .text-small { font-size: 0.8rem; color: var(--text-muted); margin-left: 0.5rem; }
    .flex-row { display: flex; gap: 0.5rem; }
    .flex-wrap { display: flex; gap: 2rem; flex-wrap: wrap; }

    .description { color: var(--text-muted); margin-bottom: 2rem; line-height: 1.6; }
    .description strong { color: var(--text-secondary); }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: var(--bg-secondary);
      border-radius: 8px;
      border: 1px solid var(--border-default);
    }

    .controls-section { display: flex; flex-direction: column; gap: 1rem; }
    .controls-section h4 {
      margin: 0;
      color: var(--text-primary);
      font-size: 1rem;
      border-bottom: 2px solid var(--accent-blue);
      padding-bottom: 0.5rem;
    }
    .controls-section > p { color: var(--text-muted); }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .control-group { display: flex; flex-direction: column; gap: 0.5rem; }
    .control-group label { font-weight: 600; color: var(--text-secondary); font-size: 0.9rem; }

    .control-group select,
    .control-group input[type="text"] {
      padding: 0.5rem;
      border: 1px solid var(--border-default);
      border-radius: 4px;
      font-size: 0.9rem;
      font-family: var(--font-mono);
      background: var(--bg-canvas);
      color: var(--text-secondary);
    }
    .control-group select:focus,
    .control-group input[type="text"]:focus {
      outline: none;
      border-color: var(--accent-blue);
    }

    .checkbox-group { display: flex; align-items: center; gap: 0.5rem; }
    .checkbox-group label { margin: 0; color: var(--text-secondary); }

    .editor-container {
      margin-top: 2rem;
      border: 2px solid var(--accent-blue);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(88, 166, 255, 0.15), 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .editor-label {
      background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
      color: white;
      padding: 0.5rem 1rem;
      font-weight: 600;
      font-size: 0.9rem;
      letter-spacing: 0.5px;
    }

    .output pre { max-height: 400px; }
    .output.error { border-color: rgba(248, 81, 73, 0.4); }
    .output.error h3 { color: var(--accent-red); }

    .code-example pre { line-height: 1.5; margin: 0; }

    button {
      padding: 0.5rem 1rem;
      background: var(--accent-green);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s;
    }
    button:hover { background: var(--accent-green-hover); }

    .header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; flex-wrap: wrap; gap: 1rem; }
    .header h1 { margin: 0; flex: 1; }

    .github-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--bg-secondary);
      color: var(--text-secondary);
      text-decoration: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.9rem;
      transition: background 0.2s;
      border: 1px solid var(--border-default);
    }
    .github-link:hover { background: var(--border-default); }
    .github-link svg { width: 20px; height: 20px; fill: currentColor; }

    .info-box {
      background: var(--bg-canvas);
      padding: 0.75rem;
      border-radius: 4px;
      margin-top: 1rem;
      font-size: 0.85rem;
      color: var(--text-muted);
      border-left: 3px solid var(--accent-blue);
    }

    /* Prism.js syntax highlighting */
    .code-example .token.comment, .code-example .token.prolog, .code-example .token.doctype { color: var(--text-muted); }
    .code-example .token.punctuation, .code-example .token.operator, .code-example .token.entity, .code-example .token.url, .code-example .token.variable { color: var(--text-secondary); }
    .code-example .token.property, .code-example .token.tag, .code-example .token.boolean, .code-example .token.number, .code-example .token.constant, .code-example .token.symbol { color: #79c0ff; }
    .code-example .token.selector, .code-example .token.attr-name, .code-example .token.string, .code-example .token.char, .code-example .token.builtin { color: #a5d6ff; }
    .code-example .token.atrule, .code-example .token.attr-value, .code-example .token.keyword { color: #ff7b72; }
    .code-example .token.function { color: #d2a8ff; }
    .code-example .token.regex, .code-example .token.important { color: #ffa657; }

    /* Modal */
    .modal { position: fixed; inset: 0; z-index: 1000; display: flex; align-items: center; justify-content: center; }
    .modal-backdrop { position: absolute; inset: 0; background: rgba(0, 0, 0, 0.7); }
    .modal-content {
      position: relative;
      background: var(--bg-primary);
      border-radius: 12px;
      width: 90%;
      max-width: 700px;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      border: 1px solid var(--border-default);
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 1.5rem;
      border-bottom: 1px solid var(--border-default);
      background: var(--bg-secondary);
    }
    .modal-header h3 { margin: 0; color: var(--text-primary); }
    .modal-close { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted); padding: 0; line-height: 1; }
    .modal-close:hover { color: var(--text-primary); }
    .modal-body { padding: 1.5rem; overflow-y: auto; max-height: calc(90vh - 60px); }
    .modal-body p { color: var(--text-muted); }
    .theme-actions { display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap; }

    #themeTextarea {
      width: 100%;
      font-family: var(--font-mono);
      font-size: 0.85rem;
      padding: 1rem;
      border: 1px solid var(--border-default);
      border-radius: 4px;
      resize: vertical;
      background: var(--bg-canvas);
      color: var(--text-secondary);
    }
    #themeTextarea:focus { outline: none; border-color: var(--accent-blue); }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div style="display: flex; align-items: center; gap: 1rem;">
        <a href="https://www.softwarity.io/" target="_blank" rel="noopener noreferrer" title="Softwarity">
          <img src="https://www.softwarity.io/img/softwarity.svg" alt="Softwarity" style="height: 40px;">
        </a>
        <div>
          <h1 style="margin-bottom: 0.5rem;">@softwarity/geojson-editor</h1>
          <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <a href="https://www.npmjs.com/package/@softwarity/geojson-editor" target="_blank" rel="noopener">
              <img src="https://img.shields.io/npm/v/@softwarity/geojson-editor?color=blue&label=npm" alt="npm version">
            </a>
            <a href="https://bundlephobia.com/package/@softwarity/geojson-editor" target="_blank" rel="noopener">
              <img src="https://img.shields.io/bundlephobia/minzip/@softwarity/geojson-editor?label=size" alt="bundle size">
            </a>
            <a href="https://github.com/softwarity/geojson-editor/blob/main/LICENSE" target="_blank" rel="noopener">
              <img src="https://img.shields.io/npm/l/@softwarity/geojson-editor" alt="license">
            </a>
          </div>
        </div>
      </div>
      <div style="display: flex; gap: 1rem; align-items: center;">
        <a href="https://github.com/softwarity/geojson-editor#readme" target="_blank" rel="noopener noreferrer" class="github-link">
          <svg viewBox="0 0 16 16" aria-hidden="true">
            <path d="M0 1.75A.75.75 0 01.75 1h4.253c1.227 0 2.317.59 3 1.501A3.744 3.744 0 0111.006 1h4.245a.75.75 0 01.75.75v10.5a.75.75 0 01-.75.75h-4.507a2.25 2.25 0 00-1.591.659l-.622.621a.75.75 0 01-1.06 0l-.622-.621A2.25 2.25 0 005.258 13H.75a.75.75 0 01-.75-.75V1.75zm8.755 3a2.25 2.25 0 012.25-2.25H14.5v9h-3.757c-.71 0-1.4.201-1.992.572l.004-7.322zm-1.504 7.324l.004-5.073-.002-2.253A2.25 2.25 0 005.003 2.5H1.5v9h3.757a3.75 3.75 0 011.994.574z"></path>
          </svg>
          Documentation
        </a>
        <a href="https://github.com/softwarity/geojson-editor" target="_blank" rel="noopener noreferrer" class="github-link">
          <svg viewBox="0 0 16 16" aria-hidden="true">
            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
          </svg>
          GitHub
        </a>
        <a href="https://www.softwarity.io/" target="_blank" rel="noopener noreferrer" class="github-link">
          <svg viewBox="0 0 16 16" aria-hidden="true">
            <path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773l.627 2.197a.75.75 0 0 1-.724.949H4.25a.75.75 0 0 1 0-1.5h.846l-.313-1.097a.75.75 0 0 1 1.446-.424l.15.525Zm5.742.424a.75.75 0 0 0-1.446.424l.15.525-.313 1.097h-.847a.75.75 0 0 0 0 1.5h2.033a.75.75 0 0 0 .724-.949l-.627-2.197-.001-.001a.75.75 0 0 0 .327-.399Z"></path>
          </svg>
          Softwarity
        </a>
      </div>
    </div>
    <div class="description">
      A lightweight <strong>~10 KB</strong> Web Component for editing GeoJSON â€” with built-in validation, contextual type highlighting, and auto-collapse coordinates.
      <span style="color: var(--text-muted);">No Monaco (2.5 MB), no CodeMirror (150 KB), just what you need for GeoJSON.</span>
    </div>

    <div class="controls">
      <div class="controls-section">
        <h4>Theme</h4>
        <div class="controls-grid">
          <div class="control-group">
            <label for="colorSchemeSelect">Color Scheme</label>
            <select id="colorSchemeSelect">
              <option value="dark" selected>Dark</option>
              <option value="light">Light</option>
            </select>
          </div>
          <div class="control-group">
            <label for="themePresetMainSelect">Theme Preset</label>
            <div style="display: flex; gap: 0.5rem;">
              <select id="themePresetMainSelect" style="flex: 1;">
                <option value="vscode" selected>VSCode (Default)</option>
                <option value="github">GitHub</option>
                <option value="onedark">One Dark / One Light</option>
                <option value="solarized">Solarized</option>
              </select>
              <button onclick="openThemeModal()" title="Edit theme" style="padding: 0.5rem 0.75rem; display: flex; align-items: center;"><span class="icon-palette"></span></button>
            </div>
          </div>
        </div>
      </div>

      <div class="controls-section">
        <h4>Dark Mode Detection</h4>
        <p style="color: #666; font-size: 0.85rem; margin-bottom: 1rem;">
          The <code>dark-selector</code> attribute lets you specify a CSS selector. The component watches for this selector
          to match, and when it does, applies its dark theme. You can use any valid CSS selector.
        </p>
        <div class="controls-grid">
          <div class="control-group">
            <label for="darkSelectorExampleSelect">Examples</label>
            <select id="darkSelectorExampleSelect">
              <option value=".dark">Self</option>
              <option value="html.dark">Tailwind CSS</option>
              <option value="html[data-bs-theme=dark]">Bootstrap</option>
            </select>
          </div>
          <div class="control-group">
            <label for="selectorPreview">Attribute Value</label>
            <input type="text" id="selectorPreview" value="dark-selector='.dark'" readonly style="font-size: 0.8rem; background: #0d1117; border-color: #30363d;">
          </div>
        </div>
        <div id="selectorDescription" style="background: #0d1117; padding: 0.75rem; border-radius: 4px; margin-top: 1rem; font-size: 0.85rem; color: #8b949e; border-left: 3px solid #58a6ff;">
          <strong>Example:</strong> <code>.dark</code> â€” The component watches for a <code>dark</code> class on itself. When present, dark theme is applied.
        </div>
      </div>

      <div class="controls-section">
        <h4>Editor Options</h4>
        <div class="control-group" style="margin-bottom: 1rem;">
          <label for="placeholderInput">Placeholder Text</label>
          <input type="text" id="placeholderInput" value="Enter GeoJSON features here...">
          <small style="color: #666; font-size: 0.85rem;">Shown when editor is empty</small>
        </div>
        <div style="display: flex; gap: 2rem; flex-wrap: wrap;">
          <div class="checkbox-group">
            <input type="checkbox" id="featureCollectionCheck" checked>
            <label for="featureCollectionCheck">FeatureCollection mode</label>
            <small style="color: #888; font-size: 0.8rem; margin-left: 0.5rem;">â€” wrap features in FeatureCollection</small>
          </div>
          <div class="checkbox-group">
            <input type="checkbox" id="autoFormatCheck" checked>
            <label for="autoFormatCheck">Auto-format JSON</label>
            <small style="color: #888; font-size: 0.8rem; margin-left: 0.5rem;">â€” indent in real-time</small>
          </div>
          <div class="checkbox-group">
            <input type="checkbox" id="readonlyCheck">
            <label for="readonlyCheck">Readonly mode</label>
            <small style="color: #888; font-size: 0.8rem; margin-left: 0.5rem;">â€” disable editing</small>
          </div>
        </div>
      </div>
    </div>

    <div class="editor-container">
      <div class="editor-label">â–¶ GeoJSON Editor Component</div>
      <geojson-editor id="editor"></geojson-editor>
    </div>

    <div class="section-box output">
      <h3>Change Events:</h3>
      <p>
        The component emits <code>change</code> events with <code>e.detail</code> containing the parsed GeoJSON object directly.
      </p>
      <pre id="eventLog">Waiting for change events...</pre>
    </div>

    <div class="section-box output error">
      <h3>Error Events:</h3>
      <p>
        When JSON is invalid, the component emits <code>error</code> events with:
        <strong>timestamp</strong>,
        <strong>error</strong> (error message),
        <strong>content</strong> (editor content for debugging)
      </p>
      <pre id="errorLog">No errors</pre>
    </div>

    <div class="section-box code-example">
      <h3>HTML Code:</h3>
      <p>
        Copy this code to use the component in your own page (updates automatically with your settings)
      </p>
      <pre id="htmlCode"></pre>
    </div>

  </div>

  <!-- Theme Editor Modal -->
  <div id="themeModal" class="modal" style="display: none;">
    <div class="modal-backdrop" onclick="closeThemeModal()"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h3 style="display: flex; align-items: center; gap: 0.5rem;"><span class="icon-palette large"></span> Theme Editor</h3>
        <button class="modal-close" onclick="closeThemeModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <p style="color: #666; font-size: 0.85rem; margin-bottom: 1rem;">
          Customize the current theme. Edit the JSON below and click "Apply" to preview.<br>
          Use "Copy Code" to get the JavaScript snippet for your implementation.
        </p>
        <textarea id="themeTextarea" rows="20" spellcheck="false"></textarea>
        <div class="theme-actions">
          <button onclick="applyTheme()">âœ“ Apply</button>
          <button onclick="resetTheme()">â†º Reset to Default</button>
          <button onclick="copyTheme()">ðŸ“‹ Copy Code</button>
        </div>
      </div>
    </div>
    <!-- Footer -->
    <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-default); text-align: center;">
      <a href="https://www.softwarity.io/" target="_blank" rel="noopener noreferrer" style="color: var(--text-muted); text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem;">
        <img src="https://www.softwarity.io/img/softwarity.svg" alt="Softwarity" style="height: 20px; opacity: 0.7;">
        <span>Made by Softwarity</span>
      </a>
    </div>
  </div>


  <script>
    const editor = document.getElementById('editor');
    const eventLog = document.getElementById('eventLog');
    const errorLog = document.getElementById('errorLog');
    const placeholderInput = document.getElementById('placeholderInput');
    const darkSelectorExampleSelect = document.getElementById('darkSelectorExampleSelect');
    const colorSchemeSelect = document.getElementById('colorSchemeSelect');
    const selectorPreview = document.getElementById('selectorPreview');
    const selectorDescription = document.getElementById('selectorDescription');
    const readonlyCheck = document.getElementById('readonlyCheck');
    const autoFormatCheck = document.getElementById('autoFormatCheck');
    const featureCollectionCheck = document.getElementById('featureCollectionCheck');
    const themeModal = document.getElementById('themeModal');
    const themeTextarea = document.getElementById('themeTextarea');
    const themePresetMainSelect = document.getElementById('themePresetMainSelect');

    // Pre-defined theme presets
    const themePresets = {
      vscode: {
        dark: {
          background: '#1e1e1e', textColor: '#d4d4d4', caretColor: '#fff',
          gutterBackground: '#252526', gutterBorder: '#3e3e42',
          jsonKey: '#9cdcfe', jsonString: '#ce9178', jsonNumber: '#b5cea8',
          jsonBoolean: '#569cd6', jsonNull: '#569cd6', jsonPunctuation: '#d4d4d4',
          collapseButton: '#c586c0', collapseButtonBg: '#3e3e42', collapseButtonBorder: '#555',
          geojsonKey: '#c586c0', geojsonType: '#4ec9b0', geojsonTypeInvalid: '#f44747', jsonKeyInvalid: '#f44747'
        },
        light: {
          background: '#ffffff', textColor: '#333333', caretColor: '#000',
          gutterBackground: '#f5f5f5', gutterBorder: '#ddd',
          jsonKey: '#0000ff', jsonString: '#a31515', jsonNumber: '#098658',
          jsonBoolean: '#0000ff', jsonNull: '#0000ff', jsonPunctuation: '#333333',
          collapseButton: '#a31515', collapseButtonBg: '#e0e0e0', collapseButtonBorder: '#999',
          geojsonKey: '#af00db', geojsonType: '#267f99', geojsonTypeInvalid: '#d32f2f', jsonKeyInvalid: '#d32f2f'
        }
      },
      github: {
        dark: {
          background: '#0d1117', textColor: '#c9d1d9', caretColor: '#c9d1d9',
          gutterBackground: '#161b22', gutterBorder: '#30363d',
          jsonKey: '#79c0ff', jsonString: '#a5d6ff', jsonNumber: '#79c0ff',
          jsonBoolean: '#ff7b72', jsonNull: '#ff7b72', jsonPunctuation: '#c9d1d9',
          collapseButton: '#d2a8ff', collapseButtonBg: '#30363d', collapseButtonBorder: '#484f58',
          geojsonKey: '#d2a8ff', geojsonType: '#7ee787', geojsonTypeInvalid: '#f85149', jsonKeyInvalid: '#f85149'
        },
        light: {
          background: '#ffffff', textColor: '#24292f', caretColor: '#24292f',
          gutterBackground: '#f6f8fa', gutterBorder: '#d0d7de',
          jsonKey: '#0550ae', jsonString: '#0a3069', jsonNumber: '#0550ae',
          jsonBoolean: '#cf222e', jsonNull: '#cf222e', jsonPunctuation: '#24292f',
          collapseButton: '#8250df', collapseButtonBg: '#eaeef2', collapseButtonBorder: '#afb8c1',
          geojsonKey: '#8250df', geojsonType: '#116329', geojsonTypeInvalid: '#cf222e', jsonKeyInvalid: '#cf222e'
        }
      },
      onedark: {
        dark: {
          background: '#282c34', textColor: '#abb2bf', caretColor: '#528bff',
          gutterBackground: '#21252b', gutterBorder: '#3e4451',
          jsonKey: '#e06c75', jsonString: '#98c379', jsonNumber: '#d19a66',
          jsonBoolean: '#d19a66', jsonNull: '#d19a66', jsonPunctuation: '#abb2bf',
          collapseButton: '#c678dd', collapseButtonBg: '#3e4451', collapseButtonBorder: '#4b5263',
          geojsonKey: '#c678dd', geojsonType: '#56b6c2', geojsonTypeInvalid: '#e06c75', jsonKeyInvalid: '#e06c75'
        },
        light: {
          background: '#fafafa', textColor: '#383a42', caretColor: '#526fff',
          gutterBackground: '#f0f0f0', gutterBorder: '#e0e0e0',
          jsonKey: '#e45649', jsonString: '#50a14f', jsonNumber: '#986801',
          jsonBoolean: '#986801', jsonNull: '#986801', jsonPunctuation: '#383a42',
          collapseButton: '#a626a4', collapseButtonBg: '#e0e0e0', collapseButtonBorder: '#999',
          geojsonKey: '#a626a4', geojsonType: '#0184bc', geojsonTypeInvalid: '#e45649', jsonKeyInvalid: '#e45649'
        }
      },
      solarized: {
        dark: {
          background: '#002b36', textColor: '#839496', caretColor: '#839496',
          gutterBackground: '#073642', gutterBorder: '#094652',
          jsonKey: '#268bd2', jsonString: '#2aa198', jsonNumber: '#d33682',
          jsonBoolean: '#cb4b16', jsonNull: '#cb4b16', jsonPunctuation: '#839496',
          collapseButton: '#6c71c4', collapseButtonBg: '#073642', collapseButtonBorder: '#586e75',
          geojsonKey: '#6c71c4', geojsonType: '#859900', geojsonTypeInvalid: '#dc322f', jsonKeyInvalid: '#dc322f'
        },
        light: {
          background: '#fdf6e3', textColor: '#657b83', caretColor: '#657b83',
          gutterBackground: '#eee8d5', gutterBorder: '#e0dbc8',
          jsonKey: '#268bd2', jsonString: '#2aa198', jsonNumber: '#d33682',
          jsonBoolean: '#cb4b16', jsonNull: '#cb4b16', jsonPunctuation: '#657b83',
          collapseButton: '#6c71c4', collapseButtonBg: '#eee8d5', collapseButtonBorder: '#93a1a1',
          geojsonKey: '#6c71c4', geojsonType: '#859900', geojsonTypeInvalid: '#dc322f', jsonKeyInvalid: '#dc322f'
        }
      }
    };
    const htmlCode = document.getElementById('htmlCode');

    // Internal dark selector value
    let darkSelector = '.dark';

    // Selector descriptions explaining what each selector does
    const selectorDescriptions = {
      '.dark': '<strong>Example:</strong> <code>.dark</code> â€” The component watches for a <code>dark</code> class on itself. When present, dark theme is applied.',
      'html.dark': '<strong>Example:</strong> <code>html.dark</code> â€” The component watches for a <code>dark</code> class on the <code>&lt;html&gt;</code> element. Useful when your page uses a global dark mode class.',
      'html[data-bs-theme=dark]': '<strong>Example:</strong> <code>html[data-bs-theme=dark]</code> â€” The component watches for a <code>data-bs-theme="dark"</code> attribute on the <code>&lt;html&gt;</code> element.'
    };

    // Handle dark selector example selection
    darkSelectorExampleSelect.addEventListener('change', (e) => {
      darkSelector = e.target.value;
      selectorPreview.value = `dark-selector="${darkSelector}"`;
      selectorDescription.innerHTML = selectorDescriptions[darkSelector];
      updateEditor();
      applyColorScheme();
    });

    // Parse dark selector to determine target element
    function parseSelector(selector) {
      // Check for class on component itself (.dark)
      if (selector.startsWith('.') && !selector.includes(' ')) {
        return {
          target: 'component',
          type: 'class',
          value: selector.substring(1) // Remove the dot
        };
      }

      // Check for class on html (html.dark)
      const htmlClassMatch = selector.match(/^html\.(.+)$/);
      if (htmlClassMatch) {
        return {
          target: 'html',
          type: 'class',
          value: htmlClassMatch[1]
        };
      }

      // Check for attribute on html (html[data-bs-theme=dark])
      const htmlAttrMatch = selector.match(/^html\[([^=]+)=([^\]]+)\]$/);
      if (htmlAttrMatch) {
        return {
          target: 'html',
          type: 'attribute',
          attr: htmlAttrMatch[1],
          value: htmlAttrMatch[2]
        };
      }

      return null;
    }

    // Apply color scheme by modifying the appropriate target
    function applyColorScheme() {
      const scheme = colorSchemeSelect.value;
      const isDark = scheme === 'dark';

      const target = parseSelector(darkSelector);
      if (!target) return;

      // Apply to component
      if (target.target === 'component') {
        if (isDark) {
          editor.classList.add(target.value);
        } else {
          editor.classList.remove(target.value);
        }
      }

      // Apply to html element
      if (target.target === 'html') {
        if (target.type === 'class') {
          if (isDark) {
            document.documentElement.classList.add(target.value);
          } else {
            document.documentElement.classList.remove(target.value);
          }
        } else if (target.type === 'attribute') {
          // For Bootstrap: set attribute to "dark" or "light"
          document.documentElement.setAttribute(target.attr, scheme);
        }
      }

    }

    // Update editor attributes from inputs
    function updateEditor() {
      editor.setAttribute('placeholder', placeholderInput.value);
      editor.setAttribute('dark-selector', darkSelector);

      if (featureCollectionCheck.checked) {
        editor.setAttribute('feature-collection', '');
      } else {
        editor.removeAttribute('feature-collection');
      }

      if (autoFormatCheck.checked) {
        editor.setAttribute('auto-format', '');
      } else {
        editor.removeAttribute('auto-format');
      }

      if (readonlyCheck.checked) {
        editor.setAttribute('readonly', '');
      } else {
        editor.removeAttribute('readonly');
      }

      updateHTMLCode();
    }

    // Update HTML code display
    function updateHTMLCode() {
      const placeholder = placeholderInput.value;
      const readonly = readonlyCheck.checked;
      const autoFormat = autoFormatCheck.checked;
      const featureCollection = featureCollectionCheck.checked;
      const scheme = colorSchemeSelect.value;
      const isDark = scheme === 'dark';

      // Parse selector to understand its type
      const selectorTarget = parseSelector(darkSelector);

      // Build component attributes
      let attrs = [];
      if (featureCollection) attrs.push('feature-collection');
      if (placeholder) attrs.push(`placeholder="${placeholder.replace(/"/g, '&quot;')}"`);
      if (autoFormat) attrs.push('auto-format');
      if (readonly) attrs.push('readonly');
      if (darkSelector) attrs.push(`dark-selector="${darkSelector.replace(/"/g, '&quot;')}"`);

      // Build HTML tag attributes based on selector type
      let htmlAttrs = 'lang="en"';
      let componentClass = '';

      if (selectorTarget) {
        if (selectorTarget.target === 'html') {
          if (selectorTarget.type === 'class' && isDark) {
            htmlAttrs += ` class="${selectorTarget.value}"`;
          } else if (selectorTarget.type === 'attribute') {
            htmlAttrs += ` ${selectorTarget.attr}="${scheme}"`;
          }
        } else if (selectorTarget.target === 'component' && isDark) {
          componentClass = ` class="${selectorTarget.value}"`;
        }
      }

      let code = '<!DOCTYPE html>\n';
      code += `<html ${htmlAttrs}>\n`;
      code += '<head>\n';
      code += '  <meta charset="UTF-8">\n';
      code += '  <title>GeoJSON Editor</title>\n';
      code += '  <script type="module">\n';
      code += '    const editor = document.querySelector(\'geojson-editor\');\n\n';
      code += '    // Valid GeoJSON - emits parsed object directly\n';
      code += '    editor.addEventListener(\'change\', (e) => {\n';
      code += '      console.log(\'GeoJSON:\', e.detail);\n';
      code += '    });\n\n';
      code += '    // Invalid JSON or GeoJSON validation error\n';
      code += '    editor.addEventListener(\'error\', (e) => {\n';
      code += '      console.error(\'Error:\', e.detail.error);\n';
      code += '    });\n';
      code += '  <\/script>\n';
      code += '</head>\n';
      code += '<body>\n';
      code += `  <geojson-editor${componentClass}\n`;
      code += '    ' + attrs.join('\n    ') + '\n';
      code += '  ></geojson-editor>\n\n';
      code += '  <script type="module" src="https://unpkg.com/@softwarity/geojson-editor"><\/script>\n';
      code += '</body>\n';
      code += '</html>';

      // Apply HTML syntax highlighting with Prism.js
      htmlCode.innerHTML = Prism.highlight(code, Prism.languages.markup, 'markup');
    }

    // Listen to editor change events (valid JSON parsed object)
    editor.addEventListener('change', (e) => {
      eventLog.textContent = JSON.stringify(e.detail, null, 2);
      // Clear error log on successful parse
      errorLog.textContent = 'No errors';
      errorLog.style.color = '';
    });

    // Listen to editor error events (invalid JSON)
    editor.addEventListener('error', (e) => {
      errorLog.textContent = JSON.stringify(e.detail, null, 2);
      errorLog.style.color = '#f85149';
    });

    // Listen to input changes
    placeholderInput.addEventListener('input', updateEditor);

    // Handle feature-collection mode toggle: reload sample data in appropriate format
    featureCollectionCheck.addEventListener('change', () => {
      updateEditor();
      loadSampleData();
    });
    readonlyCheck.addEventListener('change', updateEditor);
    autoFormatCheck.addEventListener('change', updateEditor);

    // Color scheme change - applies to the selector target and updates HTML code
    colorSchemeSelect.addEventListener('change', () => {
      applyColorScheme();
      updateHTMLCode(); // Update the generated HTML code to reflect the new scheme
    });

    // Apply preset theme directly from main selector
    themePresetMainSelect.addEventListener('change', () => {
      const presetName = themePresetMainSelect.value;
      if (presetName && themePresets[presetName]) {
        editor.setTheme(themePresets[presetName]);
      }
    });

    // Open theme modal
    function openThemeModal() {
      loadCurrentTheme();
      themeModal.style.display = 'flex';
      document.body.style.overflow = 'hidden';
    }

    // Close theme modal
    function closeThemeModal() {
      themeModal.style.display = 'none';
      document.body.style.overflow = '';
    }

    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && themeModal.style.display === 'flex') {
        closeThemeModal();
      }
    });

    // Load current theme into textarea
    function loadCurrentTheme() {
      const theme = editor.getTheme();
      themeTextarea.value = JSON.stringify(theme, null, 2);
    }

    // Apply theme from textarea
    function applyTheme() {
      try {
        const theme = JSON.parse(themeTextarea.value);
        editor.setTheme(theme);
        showThemeMessage('âœ“ Theme applied!', 'success');
      } catch (e) {
        showThemeMessage('âœ— Invalid JSON: ' + e.message, 'error');
      }
    }

    // Reset to default theme (VSCode)
    function resetTheme() {
      themePresetMainSelect.value = 'vscode';
      editor.setTheme(themePresets.vscode);
      loadCurrentTheme();
      showThemeMessage('â†º Theme reset to VSCode default', 'success');
    }

    // Copy theme to clipboard
    function copyTheme() {
      const themeCode = `// Apply custom theme to GeoJSON Editor
const editor = document.querySelector('geojson-editor');
editor.setTheme(${themeTextarea.value});`;

      navigator.clipboard.writeText(themeCode).then(() => {
        showThemeMessage('ðŸ“‹ Theme code copied to clipboard!', 'success');
      }).catch(() => {
        showThemeMessage('âœ— Failed to copy', 'error');
      });
    }

    // Show feedback message in theme modal
    function showThemeMessage(message, type) {
      const modalBody = themeModal.querySelector('.modal-body');
      const existing = modalBody.querySelector('.theme-message');
      if (existing) existing.remove();

      const msg = document.createElement('div');
      msg.className = 'theme-message';
      msg.style.cssText = `
        padding: 0.5rem 1rem;
        margin-top: 0.5rem;
        border-radius: 4px;
        font-size: 0.85rem;
        background: ${type === 'success' ? '#d4edda' : '#f8d7da'};
        color: ${type === 'success' ? '#155724' : '#721c24'};
      `;
      msg.textContent = message;
      modalBody.querySelector('.theme-actions').appendChild(msg);

      setTimeout(() => msg.remove(), 3000);
    }

    // Sample features array
    const sampleFeaturesArray = [
      {
        type: "Feature",
        geometry: { type: "Point", coordinates: [166.4581, -22.2758] },
        properties: { name: "Noumea Airport", type: "airport", color: "#3498db", category: "airport" }
      },
      {
        type: "Feature",
        geometry: { type: "LineString", coordinates: [[166.4, -22.2], [167.0, -22.5], [167.5, -23.0]] },
        properties: { name: "Flight Path", color: "#e74c3c", width: 2 }
      },
      {
        type: "Feature",
        geometry: {
          type: "Polygon",
          coordinates: [[[166.0, -22.0], [167.0, -22.0], [167.0, -23.0], [166.0, -23.0], [166.0, -22.0]]]
        },
        properties: { name: "Coverage Area", fill: "#2ecc71", stroke: "#27ae60", opacity: 0.5 }
      }
    ];

    // Load sample data in appropriate format based on mode
    function loadSampleData() {
      if (featureCollectionCheck.checked) {
        // Feature-collection mode: just the features (comma-separated)
        const featuresStr = sampleFeaturesArray.map(f => JSON.stringify(f, null, 2)).join(',\n');
        editor.setAttribute('value', featuresStr);
      } else {
        // Standalone mode: full FeatureCollection
        const featureCollection = { type: "FeatureCollection", features: sampleFeaturesArray };
        editor.setAttribute('value', JSON.stringify(featureCollection, null, 2));
      }
    }

    function clearEditor() {
      editor.setAttribute('value', '');
    }

    // Load initial sample automatically after component is ready
    customElements.whenDefined('geojson-editor').then(() => {
      updateEditor();
      applyColorScheme();
      loadSampleData();
    });
  </script>
  <script type="module" src="../src/geojson-editor.js"></script>
</body>
</html>
