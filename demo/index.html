<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GeoJSON Editor Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      padding: 2rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    h1 {
      color: #333;
      margin-bottom: 1rem;
      font-size: 2rem;
    }

    .description {
      color: #666;
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      margin-bottom: 2rem;
      padding: 1.5rem;
      background: #f5f5f5;
      border-radius: 8px;
    }

    .controls-section {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .controls-section h4 {
      margin: 0;
      color: #333;
      font-size: 1rem;
      border-bottom: 2px solid #667eea;
      padding-bottom: 0.5rem;
    }

    .controls-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .control-group label {
      font-weight: 600;
      color: #555;
      font-size: 0.9rem;
    }

    .control-group select,
    .control-group input[type="text"],
    .control-group textarea {
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.9rem;
      font-family: 'Courier New', monospace;
    }

    .control-group textarea {
      resize: vertical;
      min-height: 60px;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .checkbox-group label {
      margin: 0;
    }

    .editor-container {
      margin-top: 2rem;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
    }

    .output {
      margin-top: 2rem;
      padding: 1rem;
      background: #f9f9f9;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .output h3 {
      color: #333;
      margin-bottom: 0.5rem;
    }

    .output pre {
      background: white;
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
    }

    button {
      padding: 0.5rem 1rem;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
      transition: background 0.2s;
    }

    button:hover {
      background: #5568d3;
    }

    .theme-editor {
      margin-top: 2rem;
      padding: 1.5rem;
      background: #f9f9f9;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .theme-editor h3 {
      margin-top: 0;
      color: #333;
    }

    .theme-controls label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #555;
    }

    #themeTextarea {
      width: 100%;
      padding: 1rem;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      background: white;
      resize: vertical;
    }

    .theme-actions {
      margin-top: 1rem;
      display: flex;
      gap: 1rem;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .header h1 {
      margin: 0;
      flex: 1;
    }

    .github-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: #24292e;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 600;
      font-size: 0.9rem;
      transition: background 0.2s;
    }

    .github-link:hover {
      background: #1b1f23;
    }

    .github-link svg {
      width: 20px;
      height: 20px;
      fill: currentColor;
    }

    .code-example {
      margin-top: 2rem;
      padding: 1rem;
      background: #f9f9f9;
      border-radius: 8px;
      border: 1px solid #e0e0e0;
    }

    .code-example h3 {
      color: #333;
      margin-bottom: 0.5rem;
    }

    .code-example pre {
      background: #1e1e1e;
      padding: 1rem;
      border-radius: 4px;
      overflow-x: auto;
      font-family: 'Courier New', monospace;
      font-size: 0.85rem;
      line-height: 1.5;
      margin: 0;
      color: #d4d4d4;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>GeoJSON Editor Component Demo</h1>
      <a href="https://github.com/softwarity/geojson-editor" target="_blank" rel="noopener noreferrer" class="github-link">
        <svg viewBox="0 0 16 16" aria-hidden="true">
          <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
        </svg>
        View on GitHub
      </a>
    </div>
    <div class="description">
      This demo showcases the &lt;geojson-editor&gt; Web Component with syntax highlighting,
      collapsible nodes, and color picker integration.
    </div>

    <div class="controls">
      <div class="controls-section">
        <h4>Content Wrapping</h4>
        <div class="controls-grid">
          <div class="control-group">
            <label for="prefixInput">Prefix</label>
            <textarea id="prefixInput">{"type": "FeatureCollection", "features": [</textarea>
          </div>
          <div class="control-group">
            <label for="suffixInput">Suffix</label>
            <input type="text" id="suffixInput" value="]}">
          </div>
        </div>
      </div>

      <div class="controls-section">
        <h4>Editor Settings</h4>
        <div class="controls-grid">
          <div class="control-group">
            <label for="placeholderInput">Placeholder</label>
            <input type="text" id="placeholderInput" value="Enter GeoJSON features here...">
          </div>
          <div class="control-group">
            <label for="collapsableInput">Collapsable Keys (JSON array)</label>
            <input type="text" id="collapsableInput" value='["coordinates", "properties", "geometry"]'>
          </div>
          <div class="control-group">
            <label for="collapsedInput">Collapsed by Default (JSON array)</label>
            <input type="text" id="collapsedInput" value='["coordinates"]'>
          </div>
          <div class="control-group">
            <label for="colorAttributesInput">Color Picker Attributes (JSON array)</label>
            <input type="text" id="colorAttributesInput" value='["color"]'>
          </div>
        </div>
      </div>

      <div class="controls-section">
        <h4>Theme Detection</h4>
        <div class="controls-grid">
          <div class="control-group">
            <label>Color Scheme (fallback)</label>
            <select id="colorSchemeSelect">
              <option value="dark" selected>Dark</option>
              <option value="light">Light</option>
            </select>
          </div>
          <div class="control-group">
            <label for="darkSelectorInput">Dark Selector</label>
            <input type="text" id="darkSelectorInput" value="html@data-theme=dark">
          </div>
          <div class="control-group">
            <label for="lightSelectorInput">Light Selector</label>
            <input type="text" id="lightSelectorInput" value="html@data-theme=light">
          </div>
        </div>
      </div>

      <div class="controls-section">
        <h4>Options</h4>
        <div class="controls-grid">
          <div class="control-group checkbox-group">
            <input type="checkbox" id="autoFormatCheck" checked>
            <label for="autoFormatCheck">Auto-format</label>
          </div>
          <div class="control-group checkbox-group">
            <input type="checkbox" id="readonlyCheck">
            <label for="readonlyCheck">Readonly</label>
          </div>
        </div>
      </div>
    </div>

    <div class="editor-container">
      <geojson-editor id="editor"></geojson-editor>
    </div>

    <div class="output">
      <h3>Change Events:</h3>
      <p style="color: #666; font-size: 0.85rem; margin-bottom: 0.5rem;">
        The component emits <code>change</code> events with:
        <strong>timestamp</strong>,
        <strong>value</strong> (parsed JSON object, including prefix/suffix)
      </p>
      <pre id="eventLog">Waiting for change events...</pre>
    </div>

    <div class="output" style="background: #fff5f5; border-color: #ffcccc;">
      <h3 style="color: #c53030;">Error Events:</h3>
      <p style="color: #666; font-size: 0.85rem; margin-bottom: 0.5rem;">
        When JSON is invalid, the component emits <code>error</code> events with:
        <strong>timestamp</strong>,
        <strong>error</strong> (error message),
        <strong>content</strong> (editor content for debugging)
      </p>
      <pre id="errorLog">No errors</pre>
    </div>

    <div class="code-example">
      <h3>HTML Code:</h3>
      <p style="color: #666; font-size: 0.85rem; margin-bottom: 0.5rem;">
        Copy this code to use the component in your own page (updates automatically with your settings)
      </p>
      <pre id="htmlCode"></pre>
    </div>

    <div class="theme-editor" id="themeEditor" style="display: none;">
      <h3>Theme Editor</h3>
      <div class="theme-controls">
        <label>
          Edit theme colors (JSON format):
          <textarea id="themeTextarea" rows="15" spellcheck="false"></textarea>
        </label>
        <div class="theme-actions">
          <button onclick="applyTheme()">Apply Theme</button>
          <button onclick="resetTheme()">Reset to Default</button>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="../src/geojson-editor.js"></script>
  <script>
    const editor = document.getElementById('editor');
    const eventLog = document.getElementById('eventLog');
    const errorLog = document.getElementById('errorLog');
    const prefixInput = document.getElementById('prefixInput');
    const suffixInput = document.getElementById('suffixInput');
    const placeholderInput = document.getElementById('placeholderInput');
    const collapsableInput = document.getElementById('collapsableInput');
    const collapsedInput = document.getElementById('collapsedInput');
    const colorAttributesInput = document.getElementById('colorAttributesInput');
    const colorSchemeSelect = document.getElementById('colorSchemeSelect');
    const darkSelectorInput = document.getElementById('darkSelectorInput');
    const lightSelectorInput = document.getElementById('lightSelectorInput');
    const readonlyCheck = document.getElementById('readonlyCheck');
    const autoFormatCheck = document.getElementById('autoFormatCheck');
    const themeEditor = document.getElementById('themeEditor');
    const themeTextarea = document.getElementById('themeTextarea');
    const htmlCode = document.getElementById('htmlCode');

    // Update editor attributes from inputs
    function updateEditor() {
      editor.setAttribute('prefix', prefixInput.value);
      editor.setAttribute('suffix', suffixInput.value);
      editor.setAttribute('placeholder', placeholderInput.value);

      // Handle collapsable: empty or null means "all collapsable"
      if (collapsableInput.value && collapsableInput.value !== 'null' && collapsableInput.value !== '""') {
        editor.setAttribute('collapsable', collapsableInput.value);
      } else {
        editor.removeAttribute('collapsable');
      }

      editor.setAttribute('collapsed', collapsedInput.value);
      editor.setAttribute('color-attributes', colorAttributesInput.value);
      editor.setAttribute('dark-selector', darkSelectorInput.value);
      editor.setAttribute('light-selector', lightSelectorInput.value);

      if (autoFormatCheck.checked) {
        editor.setAttribute('auto-format', '');
      } else {
        editor.removeAttribute('auto-format');
      }

      if (readonlyCheck.checked) {
        editor.setAttribute('readonly', '');
      } else {
        editor.removeAttribute('readonly');
      }

      updateHTMLCode();
    }

    // Update HTML code display
    function updateHTMLCode() {
      const prefix = prefixInput.value;
      const suffix = suffixInput.value;
      const placeholder = placeholderInput.value;
      const collapsable = collapsableInput.value;
      const collapsed = collapsedInput.value;
      const colorAttributes = colorAttributesInput.value;
      const darkSelector = darkSelectorInput.value;
      const lightSelector = lightSelectorInput.value;
      const readonly = readonlyCheck.checked;
      const autoFormat = autoFormatCheck.checked;

      // Build attribute list
      let attrs = [];
      if (prefix) attrs.push(`prefix='${prefix.replace(/'/g, "\\'")}'`);
      if (suffix) attrs.push(`suffix='${suffix.replace(/'/g, "\\'")}'`);
      if (collapsable) attrs.push(`collapsable='${collapsable.replace(/'/g, "\\'")}'`);
      if (collapsed && collapsed !== '[]') attrs.push(`collapsed='${collapsed.replace(/'/g, "\\'")}'`);
      if (colorAttributes && colorAttributes !== '["color"]') attrs.push(`color-attributes='${colorAttributes.replace(/'/g, "\\'")}'`);
      if (placeholder) attrs.push(`placeholder="${placeholder.replace(/"/g, '&quot;')}"`);
      if (autoFormat) attrs.push('auto-format');
      if (readonly) attrs.push('readonly');
      if (darkSelector) attrs.push(`dark-selector="${darkSelector.replace(/"/g, '&quot;')}"`);
      if (lightSelector) attrs.push(`light-selector="${lightSelector.replace(/"/g, '&quot;')}"`);

      let code = '<!DOCTYPE html>\n';
      code += '<html lang="en">\n';
      code += '<head>\n';
      code += '  <meta charset="UTF-8">\n';
      code += '  <title>GeoJSON Editor</title>\n';
      code += '</head>\n';
      code += '<body>\n';
      code += '  <geojson-editor\n';
      code += '    ' + attrs.join('\n    ') + '\n';
      code += '  ></geojson-editor>\n\n';
      code += '  <script type="module">\n';
      code += '    import \'@softwarity/geojson-editor\';\n\n';
      code += '    const editor = document.querySelector(\'geojson-editor\');\n\n';
      code += '    // Valid JSON - emits parsed object\n';
      code += '    editor.addEventListener(\'change\', (e) => {\n';
      code += '      console.log(\'Timestamp:\', e.detail.timestamp);\n';
      code += '      console.log(\'Parsed Value:\', e.detail.value);\n';
      code += '    });\n\n';
      code += '    // Invalid JSON - emits error\n';
      code += '    editor.addEventListener(\'error\', (e) => {\n';
      code += '      console.error(\'Error:\', e.detail.error);\n';
      code += '      console.log(\'Content:\', e.detail.content);\n';
      code += '    });\n';
      code += '  <\/script>\n';
      code += '</body>\n';
      code += '</html>';

      htmlCode.textContent = code;
    }

    // Listen to editor change events (valid JSON parsed object)
    editor.addEventListener('change', (e) => {
      eventLog.textContent = JSON.stringify(e.detail, null, 2);
      // Clear error log on successful parse
      errorLog.textContent = 'No errors';
      errorLog.style.color = '';
    });

    // Listen to editor error events (invalid JSON)
    editor.addEventListener('error', (e) => {
      errorLog.textContent = JSON.stringify(e.detail, null, 2);
      errorLog.style.color = '#c53030';
    });

    // Listen to input changes
    prefixInput.addEventListener('input', updateEditor);
    suffixInput.addEventListener('input', updateEditor);
    placeholderInput.addEventListener('input', updateEditor);
    collapsableInput.addEventListener('input', updateEditor);
    collapsedInput.addEventListener('input', updateEditor);
    colorAttributesInput.addEventListener('input', updateEditor);
    darkSelectorInput.addEventListener('input', updateEditor);
    lightSelectorInput.addEventListener('input', updateEditor);
    readonlyCheck.addEventListener('change', updateEditor);
    autoFormatCheck.addEventListener('change', updateEditor);

    // Color scheme change (separate from theme selectors)
    colorSchemeSelect.addEventListener('change', (e) => {
      editor.setAttribute('color-scheme', e.target.value);
    });

    // Toggle theme editor
    function toggleThemeEditor() {
      const isVisible = themeEditor.style.display !== 'none';
      if (isVisible) {
        themeEditor.style.display = 'none';
      } else {
        themeEditor.style.display = 'block';
        loadCurrentTheme();
      }
    }

    // Load current theme into textarea
    function loadCurrentTheme() {
      const theme = editor.getTheme();
      themeTextarea.value = JSON.stringify(theme, null, 2);
    }

    // Apply theme from textarea
    function applyTheme() {
      try {
        const theme = JSON.parse(themeTextarea.value);
        editor.setTheme(theme);
        alert('Theme applied successfully!');
      } catch (e) {
        alert('Invalid JSON: ' + e.message);
      }
    }

    // Reset to default theme
    function resetTheme() {
      editor.resetTheme();
      loadCurrentTheme();
      alert('Theme reset to default!');
    }

    // Sample data
    function loadSampleData() {
      const sampleFeatures = `{
  "type": "Feature",
  "geometry": {
    "type": "Point",
    "coordinates": [166.4581, -22.2758]
  },
  "properties": {
    "name": "Noumea Airport",
    "color": "#3498db",
    "category": "airport"
  }
},
{
  "type": "Feature",
  "geometry": {
    "type": "LineString",
    "coordinates": [
      [166.4, -22.2],
      [167.0, -22.5],
      [167.5, -23.0]
    ]
  },
  "properties": {
    "name": "Flight Path",
    "color": "#e74c3c",
    "width": 2
  }
},
{
  "type": "Feature",
  "geometry": {
    "type": "Polygon",
    "coordinates": [
      [
        [166.0, -22.0],
        [167.0, -22.0],
        [167.0, -23.0],
        [166.0, -23.0],
        [166.0, -22.0]
      ]
    ]
  },
  "properties": {
    "name": "Coverage Area",
    "color": "#2ecc71",
    "opacity": 0.5
  }
}`;
      editor.setAttribute('value', sampleFeatures);
    }

    function clearEditor() {
      const textarea = editor.shadowRoot.getElementById('textarea');
      if (textarea) {
        textarea.value = '';
        editor.updateHighlight();
      }
    }

    // Load initial sample automatically after component is ready
    customElements.whenDefined('geojson-editor').then(() => {
      // Wait for next frame to ensure component is fully rendered
      requestAnimationFrame(() => {
        // Initialize editor with current input values
        updateEditor();
        // Load sample data
        loadSampleData();
        console.log('Sample data loaded');
      });
    });
  </script>
</body>
</html>
